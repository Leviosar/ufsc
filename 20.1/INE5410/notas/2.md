# Processos - üíª

Softwares s√£o executados como processos.

### Ciclo de vida de um processo

1. Novo: o processo est√° sendo criado.

2. Pronto: o processo foi criado e est√° pronto para ser executado.

3. Executando: o processo est√° sendo executado pela CPU.

4. Esperando: o processo foi interrompido durante a execu√ß√£o por um evento externo ou interno, pode ser a necessidade de acesso aos dispositivos IO ou outro evento qualquer.

5. Terminado: o processo finalizou sua execu√ß√£o.

Esse ciclo de vida pode ser demonstrado em uma m√°quina de estados finitos, como a que est√° logo abaixo. 

![Ciclo de vida do processo: FSM](https://imgur.com/0LTVNHq.png)

### PCB - Process control block

Cada sistema operacional tem sua maneira de armazenar as informa√ß√µes b√°sicas de um processo utilizando um PCB (Process control block), uma estrutura de dados em mem√≥ria, e apesar de cada SO tratar esses dados de maneiras diferentes, existem dados comuns a todos os SOs.

- Estado do processo
- Identificador do processor (PID)
- Program counter
- Registradores alocados
- Limites de mem√≥ria
- Informa√ß√µes de escalonamento
- Arquivos e descritores abertos


Exemplo do PCB do Linux: `task_struct`

```c
    pid t_pid; /* identificador do processo */
    long state; /* estado do processo */
    unsigned int time_slice; /* informa√ß√£o para escalonamento */
    struct task_struct* parent; /* pai do processo */
    struct list_head children; /* filhos do processo */
    struct files_struct* files; /* lista de arquivos abertos */
    struct mm_struct* mm; /* espa√ßo de endere√ßo do processo */
```

### Escalonamento de processo

O escalonamento √© o "processo" em que um programa chamado `escalonador` define  quais outros processos ser√£o executados em uma CPU.

O objetivo principal do escalonamento √© manter um bom uso de CPU, ou seja, fazer com que o tempo de processamento ocioso seja reduzido e que os processos que visam utilizar a CPU sejam "bem atendidos", alternando entre diversos processos com um conceito interno de "justi√ßa" entre processos.

Processos podem perder acesso a CPU a qualquer momento, devido a crit√©rios definidos pelo pr√≥prio escalonador, exemplos de motivos da perda de acesso s√£o: chamadas a dispositivos IO, excesso de tempo de processamento, cria√ß√£o de processos filhos.

### Troca de contexto

Um processo possui um estado atual, dados e vari√°veis que s√£o pertinentes ao contexto no qual o processo est√° executado. Se por exemplo um processo `P1` est√° computando uma contagem de 0 a 100000 e √© interrompido para que um processo `P2` seja executado, pode ser que seja desej√°vel salvar o valor atual da contagem, assim como ponteiros para instru√ß√µes e outros dados.

Ao final da execu√ß√£o de `P2`, o sistema operacional ir√° salvar tamb√©m o contexto de `P2`, antes de restaurar o √∫ltimo estado conhecido de `P1` para continuar com sua execu√ß√£o. √â importante ressaltar que o programador n√£o tem controle sobre essa troca de contexto, ela √© executada somente pelo SO.

Essa troca de contexto em si tamb√©m toma tempo de processamento, que vamos chamar de Œît, quando Œît assume valores muito pr√≥ximos ao tempo m√©dio de execu√ß√£o de processos, dizemos que a troca de contexto est√° cara.